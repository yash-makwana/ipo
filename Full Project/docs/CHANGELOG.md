# Changelog

All notable changes made to the Expectation Locker and evaluation harness.

## 2026-01-03 — Expectations heuristics & instrumentation (summary)

### Overview
- Tightened detection heuristics for expectation emission to reduce false-satisfaction and improve locked-questions coverage.
- Added structured instrumentation and diagnostics to surface *why* expectations were missed.
- Added unit tests covering both positive and negative cases for the changed heuristics.
- Re-ran the evaluator on 20 sample DRHPs and saved instrumented reports.

### Files changed
- Modified:
  - `expectation_locker.py` — added detection helpers and tightened heuristics; records `last_detection_report` with triggered/emitted/missed and evidence snippets; improved logging.
  - `tools/expectation_evaluator.py` — consumes `last_detection_report` to record `miss_reasons` and per-file `missed_questions`.
  - `config/expectation_ontology.json` — added detection hint variant `"audited financial statements"`.

- Tests added/updated:
  - `tests/test_expectation_locker.py` — expanded tests for:
    - strong vs. weak superlative citations
    - revenue completeness numeric detection
    - audited financials page reference detection
    - missed-reason reporting behavior

### Evaluation & Metrics (sample set, first 20 PDFs)
- Reports generated:
  - Before instrumentation (initial): `./reports/expectation_eval_1767448023.json`
  - After heuristics & instrumentation: `./reports/expectation_eval_1767448637.json`

- Highlights from the post-change report:
  - `superlative_claims_source`: triggered 14 → emitted 14 (previously emitted 0)
  - `revenue_disclosure_exclusions`: triggered 10 → emitted 10
  - `audited_financials_provided`: triggered 13 → emitted 11 (minor gap remains)
  - `revenue_disclosure_timeliness`: currently 0/19 emitted; identified as next candidate for heuristic refinement

### Notes & Follow-ups
- The system now records explicit `miss_reasons` and `evidence_snippet` when a heuristic marks an expectation satisfied — useful for targeted fixes.
- Next recommended task: tighten `revenue_disclosure_timeliness` detection (require explicit FY labels or a three-year table with FY columns).

---
*Generated by the compliance tooling — add to PR description when creating a code review.*
